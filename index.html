<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body style = "display:flex;flex-direction: column;align-items: center;">

<h2>Jarvis March Algorithm</h2>

<div style="display: flex; flex-direction: column; justify-content: center;">
  <div id="pointsDiv" style="background-color:#333d47;width: 700px; height: 500px; border: 3px solid black; display: flex; justify-content: center;">
    Click in this box to add points
  </div>
  <button type="button" id="start-btn" class="btn" >To visualize the algorithm</button>
  <p id='demo' style="display: none; justify-content: center; align-items: center;">Hello Javascript</p>
</div> 
<svg id="lineSVG" style="width: 500px; height: 500px; position: absolute; top: 0; left: 0; pointer-events: none; overflow: visible;"></svg> 


<script>
    let points = [];
    let count = 0;
    let currentPointIndex = 0;
    let hull = [];
    let lines = [];

    const controller = new AbortController();
    const signal = controller.signal;

    document.getElementById('pointsDiv').addEventListener('click', function(event) {
        let rect = event.target.getBoundingClientRect();
        let x = event.clientX;
        let y = event.clientY;
        points.push({ x: x, y: y });

        let pointElement = document.createElement('div');
        pointElement.style.position = 'absolute';
        pointElement.style.left = `${x - 1}px`;
        pointElement.style.top = `${y - 1}px`;
        pointElement.style.width = '7px';
        pointElement.style.height = '7px';
        pointElement.style.borderRadius = '50%';
        pointElement.style.backgroundColor = '#f3f3f3';

        event.target.appendChild(pointElement);

        console.log('Point added at position x=' + x + ' y=' + y);
    }, { signal });

    function drawLine(start, end) {
        let svg = document.getElementById('lineSVG');
        let newLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        newLine.setAttribute('stroke-width', 3)
        newLine.setAttribute('x1', start.x + 2.5);
        newLine.setAttribute('y1', start.y + 2.5);
        newLine.setAttribute('x2', end.x + 2.5);
        newLine.setAttribute('y2', end.y + 2.5);
        newLine.setAttribute('stroke', '#ff8858');
        svg.appendChild(newLine);
        lines.push(newLine);
        let pointElement = document.createElement('div');
        pointElement.style.position = 'absolute';
        pointElement.style.left = `${end.x - 5}px`;
        pointElement.style.top = `${end.y - 5}px`;
        pointElement.style.width = '15px';
        pointElement.style.height = '15px';
        pointElement.style.borderRadius = '50%';
        pointElement.style.backgroundColor = '#ff8858';
        document.getElementById('pointsDiv').appendChild(pointElement);

    }


let flag = false;
let xmax = -Infinity;
  let xmaxpoint;
  for (let i = 0; i < points.length; i++) {
    if (points[i].x > xmax) {
      xmaxpoint = points[i];
      xmax = points[i].x;
    }
  }

function findNextPoint() {
  

  let startPoint = points[currentPointIndex];
  let nextPointIndex = -1;
  let nextPoint = null;
  let maxAngle = -Infinity;

  for (let i = 0; i < points.length; i++) {
    if (i !== currentPointIndex && (!hull.includes(i) || i === hull[0])) {
      let angle = Math.atan2(points[i].y - startPoint.y, points[i].x - startPoint.x);
      console.log(angle)
      if (flag) {
        angle = angle;
      }
      if (angle > maxAngle) {
        maxAngle = angle;
        nextPointIndex = i;
        nextPoint = points[i];
      }
    }
  }
  console.log(maxAngle);
  console.log("\n");

  if (nextPoint === xmaxpoint) {
    flag = !flag;
  }

  return { index: nextPointIndex, point: nextPoint, flag: flag };
}



document.getElementById('start-btn').addEventListener('click', function(event) {
    controller.abort();
    let text = document.getElementById("demo");

    if (count === 0) {
        let xmin = Number.MAX_SAFE_INTEGER;
        let xminpoint;

        for (let i = 0; i < points.length; i++) {
            if (points[i].x < xmin) {
                xminpoint = points[i];
                xmin = points[i].x;
            }
        }

        toggleText(xminpoint);
        hull.push(currentPointIndex);
    } else {
        let { index, point } = findNextPoint();
        hull.push(index);
        drawLine(points[currentPointIndex], point);
        currentPointIndex = index;

        if (index === hull[0]) {
            drawLine(points[index], points[hull[0]]);
            text.textContent = "Convex hull completed!";
            document.getElementById('start-btn').disabled = true;
            return; 
        }
    }

    count++;
});


    function toggleText(point) {
        let text = document.getElementById("demo");
        let pointElement = document.createElement('div');
        pointElement.style.position = 'absolute';
        pointElement.style.left = `${point.x - 5}px`;
        pointElement.style.top = `${point.y - 5}px`;
        pointElement.style.width = '15px';
        pointElement.style.height = '15px';
        pointElement.style.borderRadius = '50%';
        pointElement.style.backgroundColor = '#ff8858';
        document.getElementById('pointsDiv').appendChild(pointElement);
        text.style.display = "flex";
        text.textContent = "We mark leftmost point as blue";
    }
</script>

</body>
</html>